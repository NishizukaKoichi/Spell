# Spell プロダクト／UX仕様 v1.0

## 1. 目的

Spell は、画面 UI を一切持たず、ChatGPT や CLI などのインターフェースから「呪文」を詠唱することで機能を実行する **UIレス魔法エンジン** である。本書は Spell の利用体験を定義し、実装より前にプロダクトとしての振る舞いを明確にする。

## 2. スコープ

- ChatGPT（Apps SDK/MCP）経由での Spell 体験
- ターミナルからの Spell コマンド体験
- 呪文実行までに必要な認証・決済フロー
- Rune（呪文作成機能）に到達するユーザーの位置付け

Marketplace や多組織展開は本バージョンでは扱わない。

## 3. ユーザー種別

- **一般ユーザー**: Spell の呪文実行のみを行う術者。ChatGPT もしくは CLI から詠唱する。
- **高信頼ユーザー（Rune ユーザー）**: 一般ユーザーとして Spell を利用する中で一定の信頼度を獲得し、Rune で呪文作成が可能。
- **管理者**: BAN、価格変更、ログ監査などシステム管理全般を行う。

## 4. 基本体験フロー（ChatGPT 経由）

1. ユーザーが ChatGPT 内の Spell アプリを起動。
2. ChatGPT が Spell にユーザー登録状況を問い合わせ。
3. Spell はパスキーによる本人確認を要求。
4. ChatGPT がネイティブパスキー UI を起動しユーザーが生体認証。
5. 認証成功後、ユーザーは Spell の呪文を詠唱可能。
6. ユーザーが呪文をリクエスト。
7. ChatGPT が内容を解釈し Spell の Apps SDK/MCP ツールを呼び出す。
8. Spell が呪文を実行し結果を返却。
9. ChatGPT が人間向けに整形して表示。

## 5. 決済を伴うフロー（ChatGPT 経由）

1. ユーザーが有料呪文を詠唱。
2. ChatGPT が価格を提示し実行可否を確認。
3. ユーザーが承諾。
4. 高リスク操作のため再度パスキー認証を要求。
5. 認証成功後、決済 UI（Stripe / Apple Pay 等）を起動。
6. 決済成功時に `payment_status: ok` を付与して Spell へリクエスト。
7. Spell が呪文を実行。
8. 結果をユーザーに返す。

## 6. ターミナル（CLI）での UX

- ユーザーは `spell-cli` をインストール。
- 初回 `spell auth` 実行時にブラウザ経由でパスキー登録。成功後トークンをローカル保存。
- 以降は ChatGPT 経由と同じアカウントで CLI から呪文実行可能。
- 代表コマンド:

```bash
spell list                # 呪文一覧
spell run <spell-id> --input ...  # 呪文実行
spell rune create --from spec.yml  # Rune が開放されているユーザー
```

CLI は HTTP API の薄いラッパーとして設計する。

