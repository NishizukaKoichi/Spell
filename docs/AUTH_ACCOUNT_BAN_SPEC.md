# Spell 認証・アカウント・BAN仕様 v1.0

## 1. 基本方針

Spell は UI を持たないため、認証 UI はすべて ChatGPT やブラウザに委譲する。Spell が扱うのは「認証成功を証明するトークン」とそれに紐づく `user_id` のみとし、最小限の制御に徹する。

## 2. パスキー認証モデル

- 初回パスキー登録時に Spell 内で `user_id` を発行・永続化。
- ChatGPT、CLI、その他クライアントは同一 `user_id` を参照。
- 判定ロジックは以下の通り：

```pseudo
if request.user_id is present and valid and not blacklisted:
    allow
else:
    deny
```

## 3. Rune アクセス条件（計画）

- `user_id` ごとに信頼スコアを付与（将来的に Glyph 連携）。
- Rune 開放条件の例：
  - パスキー登録済み
  - 呪文実行の実績回数が閾値以上
  - 規約違反/BAN 履歴なし
  - （将来）外部アカウント連携数や本人確認レベル

## 4. BAN / ブラックリストモデル

- BAN 単位は `user_id`。
- BAN されたユーザーからのリクエストは Spell/Rune 問わず拒否。
- BAN 理由・タイムスタンプを監査テーブルに保存。
- 将来的にはパスキー＋外部アカウントグラフ単位での BAN も検討。

## 5. 管理インターフェース要件

- 管理者は CLI/API から BAN/解除を操作。
- BAN 操作には強制的にパスキー再認証と操作ログ保存を要求。
- 監査ビューではユーザー別の認証履歴・BAN 履歴を検索可能にする。
