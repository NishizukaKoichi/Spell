{
  "version": "1.0.0",
  "platform": "spell",
  "targets": {
    "local": {
      "env": {
        "NODE_ENV": "development",
        "NEXT_PUBLIC_API_BASE": "http://localhost:3001"
      },
      "secrets": [],
      "thresholds": {
        "build_timeout_ms": 300000,
        "test_timeout_ms": 120000
      }
    },
    "ci": {
      "env": {
        "NODE_ENV": "production",
        "NEXT_PUBLIC_API_BASE": "https://api-staging.spell.dev"
      },
      "secrets": ["GITHUB_TOKEN"],
      "thresholds": {
        "build_timeout_ms": 600000,
        "test_timeout_ms": 300000,
        "max_critical_vulns": 0,
        "max_high_vulns": 5
      }
    },
    "staging": {
      "env": {
        "NODE_ENV": "production",
        "NEXT_PUBLIC_API_BASE": "https://api-staging.spell.dev"
      },
      "secrets": ["VERCEL_TOKEN", "GITHUB_TOKEN"],
      "deployment": {
        "platform": "vercel",
        "project": "spell-staging"
      },
      "thresholds": {
        "build_timeout_ms": 600000,
        "deploy_timeout_ms": 900000,
        "health_check_attempts": 3,
        "health_check_interval_ms": 5000
      }
    },
    "prod": {
      "env": {
        "NODE_ENV": "production",
        "NEXT_PUBLIC_API_BASE": "https://api.spell.dev"
      },
      "secrets": ["VERCEL_TOKEN", "GITHUB_TOKEN", "COSIGN_KEY"],
      "deployment": {
        "platform": "vercel",
        "project": "spell-production"
      },
      "thresholds": {
        "build_timeout_ms": 600000,
        "deploy_timeout_ms": 900000,
        "health_check_attempts": 5,
        "health_check_interval_ms": 10000,
        "max_critical_vulns": 0,
        "max_high_vulns": 0
      },
      "slo": {
        "availability_percent": 99.99,
        "p99_latency_ms": 200,
        "error_rate_percent": 0.01
      }
    }
  },
  "commands": {
    "setup": {
      "description": "Install dependencies",
      "steps": ["pnpm install --frozen-lockfile"]
    },
    "build": {
      "description": "Build the application",
      "steps": ["pnpm build"]
    },
    "test": {
      "description": "Run tests",
      "steps": ["pnpm lint", "pnpm typecheck", "pnpm format:check"]
    },
    "sbom": {
      "description": "Generate SBOM",
      "steps": ["syft packages dir:. -o spdx-json > .artifacts/sbom/sbom.spdx.json"],
      "optional": true
    },
    "vuln": {
      "description": "Vulnerability scan",
      "steps": ["grype dir:. -o json > .artifacts/sbom/vuln.json"],
      "optional": true
    },
    "sign": {
      "description": "Sign artifacts",
      "steps": [
        "tar -czf .artifacts/signing/build.tar.gz -C .artifacts/dist .next",
        "cosign sign-blob .artifacts/signing/build.tar.gz --bundle .artifacts/signing/build.tar.gz.bundle"
      ],
      "optional": true,
      "requires_secrets": ["COSIGN_KEY"]
    }
  }
}
